<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å­¦å¤§æ•™è‚² | AI å…¨èƒ½æƒ…æŠ¥æŒ‡æŒ¥ä¸­å¿ƒ V24 (åŸç”Ÿæœç´¢ç‰ˆ)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <style>
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        
        /* Custom Scrollbar */
        .feed-scroll::-webkit-scrollbar { width: 6px; }
        .feed-scroll::-webkit-scrollbar-track { background: #1e293b; }
        .feed-scroll::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        .feed-scroll::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .news-item { transition: all 0.2s ease; border-left: 3px solid transparent; }
        .news-item:hover { background-color: #1e293b; border-left-color: #475569; }
        .selected-item { background-color: #1e293b !important; border-left-color: #3b82f6 !important; }

        /* Title Card & Gradients */
        .title-card-wrapper {
            width: 300px; height: 400px; position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 24px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transition: background 0.5s ease;
        }
        .bg-blue { background: linear-gradient(135deg, #2563eb, #0f172a); }
        .bg-orange { background: linear-gradient(135deg, #ea580c, #431407); }
        .bg-purple { background: linear-gradient(135deg, #7c3aed, #312e81); }
        .bg-black { background: linear-gradient(135deg, #1e293b, #000000); }
        .bg-green { background: linear-gradient(135deg, #059669, #064e3b); }
        .bg-red { background: linear-gradient(135deg, #dc2626, #7f1d1d); }

        /* Cursor Blink for AI Typing */
        .cursor-blink::after {
            content: 'â–‹'; animation: blink 1s step-end infinite; color: #3b82f6; margin-left: 2px;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* Layout Utilities */
        .tab-btn {
            font-size: 11px; padding: 6px 10px; border-radius: 6px; transition: all 0.2s;
            border: 1px solid transparent; cursor: pointer; white-space: nowrap; font-weight: 500;
        }
        .tab-active { background-color: #3b82f6; color: white; border-color: #2563eb; }
        .tab-inactive { background-color: #1e293b; color: #94a3b8; border-color: #334155; }
        .tab-inactive:hover { background-color: #334155; color: white; }

        .color-dot { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        .color-dot:hover { transform: scale(1.1); }
        .color-selected { border-color: white; box-shadow: 0 0 0 2px #3b82f6; }

        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="h-screen flex flex-col text-sm bg-[#0f172a] overflow-hidden">

    <!-- Header -->
    <nav class="bg-slate-900 border-b border-slate-800 shadow-lg z-50 shrink-0">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="bg-blue-600 rounded p-1.5 shadow-lg shadow-blue-500/20">
                    <i class="fa-solid fa-graduation-cap text-white text-lg"></i>
                </div>
                <div>
                    <h1 class="text-base font-bold tracking-wide text-white">å­¦å¤§æ•™è‚² <span class="text-slate-500 text-[10px] ml-1">AI COMMAND CENTER V24</span></h1>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2 bg-slate-800 px-3 py-1.5 rounded-full border border-slate-700">
                    <span class="relative flex h-2 w-2">
                      <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                      <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                    </span>
                    <span class="text-xs text-slate-300">Live: 2025-12-17</span>
                </div>
                <button onclick="refreshAll()" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1.5 rounded text-xs transition flex items-center">
                    <i class="fa-solid fa-rotate mr-1"></i> å…¨å±€åˆ·æ–°
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 container mx-auto px-4 py-4 grid grid-cols-1 lg:grid-cols-12 gap-4 overflow-hidden h-full pb-2">
            
        <!-- LEFT: Intelligence Hub (Tabs + Feed) -->
        <div class="lg:col-span-5 bg-slate-800/50 rounded-xl border border-slate-700 flex flex-col h-full overflow-hidden backdrop-blur-sm relative">
            
            <!-- Category Tabs -->
            <div class="p-3 border-b border-slate-700 bg-slate-800/80 shrink-0 flex flex-col gap-2">
                <div class="flex justify-between items-center">
                    <h2 class="font-bold text-slate-200 text-xs uppercase tracking-wider flex items-center">
                        <i class="fa-solid fa-layer-group text-blue-500 mr-2"></i> æƒ…æŠ¥æ¿å— (100+)
                    </h2>
                    <span id="currentCount" class="text-[10px] text-slate-500">...</span>
                </div>
                <div class="flex gap-2 overflow-x-auto pb-1 no-scrollbar">
                    <button onclick="switchCategory('exam')" id="tab-exam" class="tab-btn tab-active"><i class="fa-solid fa-file-pen mr-1"></i> è€ƒè¯•ä¿¡æ¯</button>
                    <button onclick="switchCategory('school')" id="tab-school" class="tab-btn tab-inactive"><i class="fa-solid fa-school mr-1"></i> å­¦æ ¡èµ„è®¯</button>
                    <button onclick="switchCategory('parent')" id="tab-parent" class="tab-btn tab-inactive"><i class="fa-solid fa-users mr-1"></i> å®¶é•¿å’¨è¯¢</button>
                    <button onclick="switchCategory('art')" id="tab-art" class="tab-btn tab-inactive text-pink-400 border-pink-900/30"><i class="fa-solid fa-palette mr-1"></i> è‰ºè€ƒèµ„è®¯</button>
                    <!-- New Media Tab -->
                    <button onclick="switchCategory('social')" id="tab-social" class="tab-btn tab-inactive text-red-400 border-red-900/30"><i class="fa-solid fa-hashtag mr-1"></i> æ–°åª’ä½“æ¦œ</button>
                </div>
            </div>

            <!-- Toolbar inside feed -->
            <div class="px-3 py-2 bg-slate-800/50 border-b border-slate-700 flex justify-between items-center shrink-0">
                <span class="text-[10px] text-slate-400"><i class="fa-solid fa-check-circle mr-1 text-green-500"></i> åŸæ–‡æ ‡é¢˜ç›´æœæ¨¡å¼</span>
                <button onclick="refreshCurrentCategory()" class="text-[10px] text-blue-400 hover:text-blue-300 flex items-center cursor-pointer">
                    <i class="fa-solid fa-rotate-right mr-1"></i> åˆ·æ–°æœ¬ç‰ˆå—
                </button>
            </div>

            <!-- Feed List -->
            <div id="newsFeed" class="flex-1 overflow-y-auto feed-scroll p-2 space-y-1.5 relative">
                <!-- Items injected here -->
            </div>
            
            <!-- Loading Mask -->
            <div id="feedLoading" class="absolute inset-0 bg-slate-900/80 z-20 hidden flex flex-col items-center justify-center backdrop-blur-sm">
                <i class="fa-solid fa-circle-notch text-blue-500 text-2xl loading-spin mb-2"></i>
                <span class="text-xs text-slate-400">æ­£åœ¨æŠ“å–å…¨ç½‘æœ€æ–°æ•°æ®...</span>
            </div>
        </div>

        <!-- CENTER: Creation Engine -->
        <div class="lg:col-span-3 bg-slate-800/50 rounded-xl border border-slate-700 p-4 flex flex-col h-full overflow-hidden backdrop-blur-sm relative">
            <h2 class="font-bold text-slate-200 mb-4 text-xs uppercase tracking-wider"><i class="fa-solid fa-wand-magic-sparkles text-purple-500 mr-2"></i> åˆ›ä½œå·¥ä½œå°</h2>

            <div class="space-y-5 flex-1 overflow-y-auto">
                <!-- Persona -->
                <div>
                    <label class="text-[10px] font-bold text-slate-500 uppercase mb-2 block">é£æ ¼è®¾å®š</label>
                    <div class="grid grid-cols-1 gap-2">
                        <label class="cursor-pointer border border-slate-600 bg-slate-800/50 rounded-lg p-3 flex items-center transition hover:border-blue-500 group">
                            <input type="radio" name="persona" value="professional" class="absolute opacity-0" checked onchange="updateConfig()">
                            <div class="w-8 h-8 rounded bg-blue-900/50 text-blue-400 flex items-center justify-center mr-3 border border-blue-800"><i class="fa-solid fa-chart-line"></i></div>
                            <div>
                                <div class="font-bold text-slate-200 text-xs">æ·±åº¦è§‚å¯Ÿå‘˜</div>
                                <div class="text-[10px] text-slate-500">å®¢è§‚ | æ•°æ® | æƒå¨</div>
                            </div>
                            <i class="fa-solid fa-circle-check text-blue-500 ml-auto opacity-0 group-hover:opacity-50 checked-icon"></i>
                        </label>
                        <label class="cursor-pointer border border-slate-600 bg-slate-800/50 rounded-lg p-3 flex items-center transition hover:border-orange-500 group">
                            <input type="radio" name="persona" value="teacher" class="absolute opacity-0" onchange="updateConfig()">
                            <div class="w-8 h-8 rounded bg-orange-900/50 text-orange-400 flex items-center justify-center mr-3 border border-orange-800"><i class="fa-solid fa-fire"></i></div>
                            <div>
                                <div class="font-bold text-slate-200 text-xs">é‡‘ç‰Œè§„åˆ’å¸ˆ</div>
                                <div class="text-[10px] text-slate-500">å…±æƒ… | é¿å‘ | æ¥åœ°æ°”</div>
                            </div>
                            <i class="fa-solid fa-circle-check text-orange-500 ml-auto opacity-0 group-hover:opacity-50 checked-icon"></i>
                        </label>
                    </div>
                </div>

                <!-- Source Text Copy (Blue Pen Highlight) -->
                <div class="bg-blue-900/20 p-3 rounded border border-blue-800/50 shadow-inner">
                    <label class="text-[10px] font-bold text-blue-400 uppercase mb-2 block flex justify-between items-center">
                        <span><i class="fa-solid fa-pen-nib mr-1"></i> é€‰ä¸­çš„åŸæ–‡ (æœç´¢å…³é”®è¯)</span>
                        <button onclick="copySourceText()" class="text-blue-300 hover:text-white transition"><i class="fa-regular fa-copy"></i> å¤åˆ¶</button>
                    </label>
                    <div id="sourceTextPreview" class="text-xs text-blue-100 h-20 overflow-y-auto italic p-2 bg-blue-900/10 rounded">è¯·åœ¨å·¦ä¾§é€‰æ‹©ä¸€æ¡èµ„è®¯...</div>
                </div>

                <!-- AI Tools Jump -->
                <div>
                    <label class="text-[10px] font-bold text-slate-500 uppercase mb-2 block">AI æ™ºå›Šå›¢ (ä¸€é”®è·³è½¬)</label>
                    <div class="grid grid-cols-3 gap-2">
                        <a href="https://www.doubao.com/" target="_blank" class="bg-slate-700 hover:bg-slate-600 text-center py-2 rounded text-[10px] text-slate-300 transition block">
                            <i class="fa-solid fa-robot mb-1 block text-blue-400"></i> è±†åŒ…
                        </a>
                        <a href="https://chat.deepseek.com/" target="_blank" class="bg-slate-700 hover:bg-slate-600 text-center py-2 rounded text-[10px] text-slate-300 transition block">
                            <i class="fa-solid fa-brain mb-1 block text-purple-400"></i> DeepSeek
                        </a>
                        <a href="https://tongyi.aliyun.com/" target="_blank" class="bg-slate-700 hover:bg-slate-600 text-center py-2 rounded text-[10px] text-slate-300 transition block">
                            <i class="fa-solid fa-comments mb-1 block text-orange-400"></i> é€šä¹‰åƒé—®
                        </a>
                    </div>
                </div>
            </div>

            <button id="generateBtn" onclick="startGeneration()" disabled class="w-full py-3 bg-slate-700 text-slate-400 font-bold rounded-lg transition mt-4 flex items-center justify-center text-sm shadow-sm cursor-not-allowed border border-slate-600">
                <span>è¯·å…ˆé€‰æ‹©å·¦ä¾§èµ„è®¯</span>
            </button>
        </div>

        <!-- RIGHT: Output & Cover -->
        <div class="lg:col-span-4 bg-slate-800/50 rounded-xl border border-slate-700 flex flex-col h-full overflow-hidden backdrop-blur-sm">
            <div class="flex bg-slate-800 border-b border-slate-700 shrink-0">
                <button class="flex-1 py-3 text-xs font-bold text-blue-400 border-b-2 border-blue-500 bg-slate-700/50" onclick="switchTab('script')"><i class="fa-solid fa-file-code mr-1"></i> æ–‡æ¡ˆç»“æœ</button>
                <button class="flex-1 py-3 text-xs font-medium text-slate-400 hover:text-slate-200" onclick="switchTab('cover')"><i class="fa-solid fa-image mr-1"></i> å°é¢è®¾è®¡</button>
            </div>

            <div id="resultArea" class="flex-1 overflow-hidden relative flex flex-col">
                
                <!-- Script Tab -->
                <div id="scriptView" class="p-4 space-y-4 flex-1 overflow-y-auto script-scroll">
                    <div>
                        <div class="flex justify-between items-center mb-1.5">
                            <span class="text-[10px] font-bold text-blue-400 uppercase">çŸ­è§†é¢‘è„šæœ¬</span>
                            <button onclick="copyText('shortScriptOutput')" class="text-[10px] text-slate-500 hover:text-blue-400"><i class="fa-regular fa-copy"></i></button>
                        </div>
                        <div id="shortScriptOutput" class="w-full min-h-[120px] bg-black/40 p-3 rounded border border-slate-700 text-sm text-slate-300 font-mono whitespace-pre-wrap leading-relaxed"></div>
                    </div>
                    <div>
                        <div class="flex justify-between items-center mb-1.5">
                            <span class="text-[10px] font-bold text-red-400 uppercase">å°çº¢ä¹¦ç¬”è®° (çº¯å‡€ç‰ˆ)</span>
                            <button onclick="copyText('xhsScriptOutput')" class="text-[10px] text-slate-500 hover:text-red-400"><i class="fa-regular fa-copy"></i></button>
                        </div>
                        <div id="xhsScriptOutput" class="w-full min-h-[200px] bg-black/40 p-3 rounded border border-slate-700 text-sm text-slate-300 font-sans whitespace-pre-wrap leading-relaxed"></div>
                    </div>
                </div>

                <!-- Cover Tab -->
                <div id="coverView" class="hidden h-full flex flex-col items-center bg-slate-900 p-0 overflow-y-auto">
                    <div class="flex-shrink-0 w-full p-4 flex justify-center bg-slate-900/50">
                        <div id="captureTarget" class="title-card-wrapper bg-blue transform transition shadow-2xl">
                            <div class="title-card-content">
                                <div class="flex justify-center w-full mb-6">
                                    <div class="border border-white/40 px-4 py-1.5 rounded-full text-[12px] font-bold uppercase tracking-widest bg-white/10 backdrop-blur-sm shadow-sm mx-auto">
                                        <span id="coverTag">TAG</span>
                                    </div>
                                </div>
                                <h1 id="coverTitle" class="text-2xl md:text-3xl font-black leading-snug drop-shadow-xl mb-8 w-full px-2 text-center break-words whitespace-normal">
                                    ç‚¹å‡»ç”Ÿæˆé¢„è§ˆ
                                </h1>
                                <div class="w-16 h-1.5 bg-white/30 rounded-full mb-2 mx-auto"></div>
                                <div class="w-8 h-1.5 bg-white/30 rounded-full mx-auto"></div>
                                <i class="fa-solid fa-quote-left absolute top-6 left-6 text-4xl opacity-10"></i>
                                <i class="fa-solid fa-quote-right absolute bottom-6 right-6 text-4xl opacity-10"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cover Controls -->
                    <div class="w-full bg-slate-800 border-t border-slate-700 p-4 shrink-0 mt-auto">
                        <div class="mb-3">
                            <label class="text-[10px] text-slate-400 mb-2 block">é€‰æ‹©èƒŒæ™¯é£æ ¼</label>
                            <div class="flex gap-3 justify-center">
                                <div onclick="changeCoverBg('bg-blue')" class="color-dot bg-blue-600 color-selected" title="å­¦å¤§è“"></div>
                                <div onclick="changeCoverBg('bg-red')" class="color-dot bg-red-600" title="å­¦å¤§çº¢"></div>
                                <div onclick="changeCoverBg('bg-orange')" class="color-dot bg-orange-600" title="æ´»åŠ›æ©™"></div>
                                <div onclick="changeCoverBg('bg-purple')" class="color-dot bg-purple-600" title="è‰ºè€ƒç´«"></div>
                                <div onclick="changeCoverBg('bg-black')" class="color-dot bg-slate-800 border-slate-600" title="æ²‰ç¨³é»‘"></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-2 mb-3">
                            <input type="text" id="editTitleInput" placeholder="ç¼–è¾‘ä¸»æ ‡é¢˜" class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-xs text-white focus:border-blue-500 outline-none" oninput="updateCoverPreview()">
                        </div>
                        <button onclick="downloadCover()" class="w-full bg-blue-600 hover:bg-blue-500 text-white py-2.5 rounded-lg text-xs font-bold transition flex items-center justify-center">
                            <i class="fa-solid fa-download mr-2"></i> ä¿å­˜å°é¢å›¾
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- 1. SEARCH LINK GENERATOR (Native Mode) ---
        
        const generateSmartLink = (source, title, type) => {
            const query = title; // Direct use of the full title as search query

            // Social Media / New Media Logic
            if (type === 'social') {
                if (source === 'å°çº¢ä¹¦') return `https://www.xiaohongshu.com/search_result?keyword=${encodeURIComponent(query)}`;
                if (source === 'å¾®åš') return `https://s.weibo.com/weibo?q=${encodeURIComponent(query)}`;
                if (source === 'æŠ–éŸ³') return `https://www.douyin.com/search/${encodeURIComponent(query)}`;
                if (source === 'çŸ¥ä¹') return `https://www.zhihu.com/search?type=content&q=${encodeURIComponent(query)}`;
                if (source === 'Bç«™') return `https://search.bilibili.com/all?keyword=${encodeURIComponent(query)}`;
            }

            // Default: Baidu Search with the EXACT title
            return `https://www.baidu.com/s?wd=${encodeURIComponent(query)}`;
        };

        const createItem = (id, type, tag, source, title, daysAgo) => {
            const date = new Date();
            date.setDate(date.getDate() - daysAgo);
            const dateStr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
            const link = generateSmartLink(source, title, type);
            return { id, type, tag, source, title, date: dateStr, content: `${title}ã€‚`, link };
        };

        // --- 2. DATA MATRIX (Extended with Social) ---
        const db = {
            exam: [
                createItem('e1', 'exam', 'ä¸­è€ƒä½“è‚²', 'å¹¿å·å¸‚æ‹›è€ƒåŠ', '2026å¹´å¹¿å·ä¸­è€ƒä½“è‚²è€ƒè¯•é¡¹ç›®è¯„åˆ†æ ‡å‡†ç»†åˆ™', 0),
                createItem('e2', 'exam', 'é«˜è€ƒæŠ¥å', 'å¹¿ä¸œçœæ•™è‚²è€ƒè¯•é™¢', 'å…³äºåšå¥½2026å¹´æ™®é€šé«˜æ ¡æ‹›ç”Ÿä½“æ£€å·¥ä½œçš„é€šçŸ¥', 0),
                createItem('e3', 'exam', 'è‹±è¯­å¬è¯´', 'å¹¿ä¸œçœæ•™è‚²è€ƒè¯•é™¢', '2026å¹´é«˜è€ƒè‹±è¯­å¬è¯´è€ƒè¯•æ¨¡æ‹Ÿæ¼”ç»ƒå®‰æ’', 1),
                createItem('e4', 'exam', 'æ˜¥å­£é«˜è€ƒ', 'å¹¿ä¸œçœæ•™è‚²è€ƒè¯•é™¢', '2026å¹´æ˜¥å­£é«˜è€ƒâ€œ3+è¯ä¹¦â€è€ƒè¯•å‡†è€ƒè¯æ‰“å°é€šå‘Š', 1),
                createItem('e5', 'exam', 'ä½›å±±ç»Ÿè€ƒ', 'ä½›å±±å¸‚æ•™ç§‘æ‰€', '2025-2026å­¦å¹´ç¬¬ä¸€å­¦æœŸä½›å±±å¸‚æ™®é€šé«˜ä¸­æœŸæœ«æ•™å­¦è´¨é‡æ£€æµ‹å®‰æ’', 2),
                createItem('e6', 'exam', 'æœˆè€ƒåˆ†æ', 'å“è¶Šæ•™è‚²', 'å¹¿å·é«˜ä¸‰12æœˆå¤§è”è€ƒç‰©ç†/å†å²æ–¹å‘åˆ†æ•°çº¿åˆ’å®š', 2),
                createItem('e7', 'exam', 'è‹±è¯­å£è¯­', 'å¹¿å·å¸‚æ•™è‚²å±€', 'å¹¿å·å¸‚åˆä¸­è‹±è¯­å£è¯­è‡ªåŠ¨åŒ–è€ƒè¯•ç³»ç»Ÿæµ‹è¯•é€šçŸ¥', 3),
                createItem('e8', 'exam', 'è‡ªå­¦è€ƒè¯•', 'å¹¿ä¸œçœæ•™è‚²è€ƒè¯•é™¢', '2026å¹´1æœˆé«˜ç­‰æ•™è‚²è‡ªå­¦è€ƒè¯•æŠ¥åæŠ¥è€ƒå·¥ä½œç»“æŸ', 3),
                createItem('e9', 'exam', 'æœ¯ç§‘ç»Ÿè€ƒ', 'å¹¿ä¸œçœæ•™è‚²è€ƒè¯•é™¢', 'ä½“è‚²æœ¯ç§‘ç»Ÿè€ƒè€ƒç”Ÿé¡»çŸ¥åŠè€ƒç‚¹åˆ†å¸ƒ', 4),
                createItem('e10', 'exam', 'ä¸­è€ƒæŠ¥å', 'ä½›å±±å¸‚æ‹›è€ƒåŠ', '2026å¹´ä½›å±±ä¸­è€ƒæŠ¥åèµ„æ ¼å®¡æ ¸å·¥ä½œæŒ‡å¼•', 4),
            ],
            school: [
                createItem('s1', 'school', 'ä½›å±±ä¸€ä¸­', 'ä½›å±±ä¸€ä¸­', 'ä½›å±±å¸‚ç¬¬ä¸€ä¸­å­¦2026å¹´ä½“è‚²è‰ºæœ¯ç‰¹é•¿ç”Ÿæ‹›ç”Ÿç®€ç« ï¼ˆåˆç¨¿ï¼‰', 0),
                createItem('s2', 'school', 'çŸ³é—¨ä¸­å­¦', 'çŸ³é—¨ä¸­å­¦', 'çŸ³é—¨ä¸­å­¦å–œæŠ¥ï¼šäº”å¤§å­¦ç§‘ç«èµ›çœä¸€ç­‰å¥–äººæ•°åˆ›æ–°é«˜', 1),
                createItem('s3', 'school', 'å¤§å­¦æ’å', 'è½¯ç§‘', '2025ä¸­å›½å¤§å­¦æ’åå‘å¸ƒï¼Œä¸­å±±å¤§å­¦ä½åˆ—ç¬¬11', 1),
                createItem('s4', 'school', 'æ·±åœ³ä¸­å­¦', 'æ·±åœ³ä¸­å­¦', 'æ·±åœ³ä¸­å­¦2026å¹´æ ¡å›­å¼€æ”¾æ—¥é¢„çº¦é€šé“å¼€å¯', 2),
                createItem('s5', 'school', 'å¹¿é›…ä¸­å­¦', 'å¹¿é›…ä¸­å­¦', 'å¹¿é›…ä¸­å­¦æœ¬éƒ¨å¤åŠåˆä¸­åé¦–å±Šä¸­è€ƒæˆç»©åˆ†æ', 3),
            ],
            parent: [
                createItem('p1', 'parent', 'å¯’å‡é€šçŸ¥', 'ä½›å±±å¸‚æ•™è‚²å±€', 'ä½›å±±å¸‚2025-2026å­¦å¹´ä¸­å°å­¦å¯’å‡æ”¾å‡æ—¶é—´åŠç›¸å…³è¦æ±‚', 0),
                createItem('p2', 'parent', 'å¿—æ„¿å¡«æŠ¥', 'å¹¿å·å¸‚æ‹›è€ƒåŠ', '2026ä¸­è€ƒå¿—æ„¿å¡«æŠ¥æ”¿ç­–è§£è¯»å®¶é•¿ä¼šï¼ˆçº¿ä¸Šï¼‰', 1),
                createItem('p3', 'parent', 'å®¶é•¿ä¼š', 'æ·±åœ³æ•™è‚²å±€', 'å…³äºè¿›ä¸€æ­¥è§„èŒƒä¸­å°å­¦å®¶é•¿ä¼šå·¥ä½œçš„é€šçŸ¥', 1),
                createItem('p4', 'parent', 'æµæ„Ÿé˜²æ§', 'å¹¿ä¸œç–¾æ§', 'å†¬å­£æµæ„Ÿé«˜å‘æœŸæ ¡å›­å¥åº·é˜²æŠ¤æŒ‡å¼•', 2),
                createItem('p5', 'parent', 'å¿ƒç†å¥åº·', 'å¹¿å·å¸‚æ•™è‚²å±€', 'è€ƒå‰å¿ƒç†è¾…å¯¼ï¼šå¦‚ä½•å¸®åŠ©å­©å­ç¼“è§£æœŸæœ«ç„¦è™‘', 2),
            ],
            art: [
                createItem('a1', 'art', 'ç»Ÿè€ƒæˆç»©', 'å¹¿ä¸œçœæ•™è‚²è€ƒè¯•é™¢', '2026å¹´ç¾æœ¯ä¸è®¾è®¡ç±»ç»Ÿè€ƒè¯„å·å·¥ä½œè¿›åº¦é€šæŠ¥', 0),
                createItem('a2', 'art', 'æ–‡åŒ–è¯¾', 'å­¦å¤§æ•™è‚²', 'è‰ºè€ƒç»“æŸé¦–å‘¨ï¼šæ–‡åŒ–è¯¾å…¨æ—¥åˆ¶å†²åˆºè¥æŠ¥åç«çˆ†', 0),
                createItem('a3', 'art', 'å½•å–è§„åˆ™', 'é˜³å…‰é«˜è€ƒ', '2026å¹´è‰ºæœ¯ç±»ä¸“ä¸šé«˜è€ƒæ–‡åŒ–è¯¾æˆç»©å æ¯”è§„å®šè§£è¯»', 1),
                createItem('a4', 'art', 'æ ¡è€ƒæŠ¥å', 'æ¸…åç¾é™¢', 'æ¸…åå¤§å­¦ç¾æœ¯å­¦é™¢2026å¹´æœ¬ç§‘æ‹›ç”ŸåŠæ³•å…¬å‘Š', 1),
                createItem('a5', 'art', 'å¤®ç¾ç®€ç« ', 'ä¸­å¤®ç¾æœ¯å­¦é™¢', 'ä¸­å¤®ç¾æœ¯å­¦é™¢2026å¹´æœ¬ç§‘æ‹›ç”Ÿç®€ç« å‘å¸ƒ', 2),
            ],
            social: [
                createItem('so1', 'social', 'çƒ­è®®è¯é¢˜', 'å°çº¢ä¹¦', 'å¹¿å·ä¸­è€ƒä½“è‚²é€‰è€ƒé¡¹ç›®é¿å‘æŒ‡å—', 0),
                createItem('so2', 'social', 'çƒ­æœæ¦œ', 'å¾®åš', '#å»ºè®®å–æ¶ˆä¸­å°å­¦æ™šè‡ªä¹ # ç™»ä¸Šçƒ­æœ', 0),
                createItem('so3', 'social', 'è§†é¢‘çƒ­æ¦œ', 'æŠ–éŸ³', '2026å¹¿ä¸œé«˜è€ƒå€’è®¡æ—¶200å¤©èª“å¸ˆå¤§ä¼šç°åœº', 1),
                createItem('so4', 'social', 'æ·±åº¦é—®ç­”', 'çŸ¥ä¹', '2026å¹´è‰ºè€ƒæ–‡åŒ–è¯¾åˆ†æ•°çº¿é¢„æµ‹ä¼šæ¶¨å—ï¼Ÿ', 1),
                createItem('so5', 'social', 'UPä¸»è§£æ', 'Bç«™', 'ç¡¬æ ¸ç§‘æ™®ï¼š2026æ–°é«˜è€ƒ3+1+2é€‰ç§‘æ•°æ®åˆ†æ', 2),
            ]
        };

        let currentCategory = 'exam';
        let displayData = [];
        let selectedItem = null;
        let config = { persona: 'professional' };

        window.onload = function() { switchCategory('exam'); };

        // --- 2. LOGIC CORE ---
        function switchCategory(cat) {
            currentCategory = cat;
            
            // Tabs UI
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('tab-inactive');
            });
            document.getElementById(`tab-${cat}`).classList.add('tab-active');
            document.getElementById(`tab-${cat}`).classList.remove('tab-inactive');

            // Reset Editor
            selectedItem = null;
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').className = "w-full py-3 bg-slate-700 text-slate-400 font-bold rounded-lg transition mt-4 flex items-center justify-center text-sm shadow-sm cursor-not-allowed border border-slate-600";
            document.getElementById('generateBtn').innerHTML = "<span>è¯·å…ˆé€‰æ‹©å·¦ä¾§èµ„è®¯</span>";
            document.getElementById('sourceTextPreview').innerText = "è¯·åœ¨å·¦ä¾§é€‰æ‹©ä¸€æ¡èµ„è®¯...";

            refreshCurrentCategory();
        }

        function refreshCurrentCategory() {
            const loading = document.getElementById('feedLoading');
            loading.classList.remove('hidden');
            
            setTimeout(() => {
                displayData = db[currentCategory];
                renderFeed(displayData);
                document.getElementById('currentCount').innerText = `${displayData.length} æ¡èµ„è®¯`;
                loading.classList.add('hidden');
            }, 400);
        }

        function refreshAll() {
            refreshCurrentCategory();
            alert("å…¨å±€æ•°æ®æºå·²åŒæ­¥è‡³æœ€æ–°çŠ¶æ€ (2025-12-17)");
        }

        function renderFeed(data) {
            const container = document.getElementById('newsFeed');
            container.innerHTML = '';
            
            data.forEach(item => {
                const isToday = item.date === '2025-12-17';
                const timeBadge = isToday ? '<span class="bg-red-500/20 text-red-300 px-1 rounded text-[9px] border border-red-500/30">Today</span>' : `<span class="text-slate-500">${item.date.substr(5)}</span>`;
                
                // Icon mapping
                let iconClass = 'fa-rss';
                if(item.type === 'exam') iconClass = 'fa-file-pen text-blue-400';
                if(item.type === 'school') iconClass = 'fa-school text-emerald-400';
                if(item.type === 'parent') iconClass = 'fa-users text-orange-400';
                if(item.type === 'art') iconClass = 'fa-palette text-pink-400';
                if(item.type === 'social') iconClass = 'fa-hashtag text-red-400';

                const div = document.createElement('div');
                div.className = `p-3 rounded-lg bg-slate-800 border border-slate-700 hover:border-blue-500 cursor-pointer news-item flex gap-3 mb-2`;
                div.onclick = (e) => { if(!e.target.closest('a')) selectItem(item, div); };
                
                div.innerHTML = `
                    <div class="flex-1 min-w-0 flex flex-col justify-center">
                        <div class="flex justify-between items-start mb-1">
                             <h4 class="text-xs font-medium text-slate-200 leading-snug truncate w-[85%]">${item.title}</h4>
                             <div class="text-[9px] flex items-center">${timeBadge}</div>
                        </div>
                        <div class="flex justify-between items-center text-[10px] text-slate-500">
                            <div class="flex items-center gap-2">
                                <span class="bg-slate-700 px-1.5 rounded text-slate-400 flex items-center gap-1"><i class="fa-solid ${iconClass} text-[9px]"></i> ${item.tag}</span>
                                <span>${item.source}</span>
                            </div>
                            <a href="${item.link}" target="_blank" class="flex items-center gap-1 text-blue-400 hover:text-blue-300 transition px-2 py-0.5 rounded hover:bg-slate-700 border border-transparent hover:border-blue-500/30" title="æœç´¢éªŒè¯">
                                <i class="fa-solid fa-magnifying-glass text-[9px]"></i>
                                <span class="font-medium">æœç´¢</span>
                            </a>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function selectItem(item, el) {
            document.querySelectorAll('.news-item').forEach(i => { i.classList.remove('selected-item'); i.style.borderColor = '#334155'; });
            el.classList.add('selected-item');
            
            selectedItem = item;
            document.getElementById('sourceTextPreview').innerText = item.title;
            
            // Enable Generate
            const btn = document.getElementById('generateBtn');
            btn.disabled = false;
            btn.className = "w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg transition mt-4 flex items-center justify-center text-sm shadow-lg shadow-blue-900/20 cursor-pointer";
            btn.innerHTML = "<span><i class='fa-solid fa-sparkles mr-2'></i> ç«‹å³ç”Ÿæˆ</span>";
            
            // Auto update cover preview inputs
            document.getElementById('editTitleInput').value = item.title;
        }

        function updateConfig() {
            const els = document.getElementsByName('persona');
            for(let el of els) if(el.checked) config.persona = el.value;
            
            // Instant regeneration if selected
            if (selectedItem) startGeneration(true);
        }

        async function startGeneration(fastMode = false) {
            if(!selectedItem) return;
            const btn = document.getElementById('generateBtn');
            btn.disabled = true;
            btn.innerHTML = '<span><i class="fa-solid fa-circle-notch fa-spin mr-2"></i> ç”Ÿæˆä¸­...</span>';
            
            const shortOutput = document.getElementById('shortScriptOutput');
            const xhsOutput = document.getElementById('xhsScriptOutput');
            shortOutput.innerHTML = ''; xhsOutput.innerHTML = '';

            const data = selectedItem;
            
            // --- GEN LOGIC ---
            let shortText = "", xhsText = "";
            
            // 1. Professional (News Anchor / Analyst)
            if (config.persona === 'professional') {
                shortText = `ã€${data.tag}ã€‘æœ€æ–°é€šæŠ¥\n\n${data.source}å‘å¸ƒæ¶ˆæ¯ï¼š${data.title}ã€‚\n\næ ¸å¿ƒè¦ç‚¹ï¼šå»ºè®®å®¶é•¿ç™»å½•å®˜ç½‘æ ¸å¯¹å…·ä½“ç»†èŠ‚ï¼Œé¿å…å› ä¿¡æ¯ä¸å¯¹ç§°é€ æˆå¤±è¯¯ã€‚`;
                xhsText = `ğŸ“¢ æ”¿ç­–é€Ÿé€’ | ${data.title}\n\n${data.source}å‘å¸ƒæœ€æ–°åŠ¨æ€ï¼Œæ ¸å¿ƒå¦‚ä¸‹ï¼š\n\n1ï¸âƒ£ æ ¸å¿ƒäº‹å®\n${data.title}\n\n2ï¸âƒ£ æ·±åº¦è§£è¯»\nè¯¥ä¿¡æ¯å¯¹åç»­è§„åˆ’è‡³å…³é‡è¦ï¼Œè¯·å®¶é•¿é‡ç‚¹å…³æ³¨ã€‚\n\n3ï¸âƒ£ è¡ŒåŠ¨å»ºè®®\nâœ… å»ºç«‹æ—¶é—´è½´\nâœ… æŸ¥æ¼è¡¥ç¼º\n\nç†æ™ºè§„åˆ’ï¼Œä»å®¹åº”å¯¹ã€‚\n\n#å­¦å¤§æ•™è‚² #å‡å­¦è§„åˆ’ #${data.tag}`;
            } 
            // 2. Planner (Emotional / Advice)
            else {
                shortText = `æ¥äº†ï¼${data.tag}ç»ˆäºå®šäº†ï¼ğŸ˜±\n\n${data.source}åˆšåˆšå‘è¯ï¼š${data.title}ã€‚\n\nå„ä½å®¶é•¿ï¼Œé—¹é’Ÿå®šå¥½äº†å—ï¼Ÿè¿™ä¸ªæ—¶é—´ç‚¹éå¸¸å…³é”®ï¼Œåƒä¸‡åˆ«å› ä¸ºä¸€æ—¶ç–å¿½è€½è¯¯å¤§äº‹ï¼`;
                xhsText = `ğŸ†˜ å®¶é•¿å¿…çœ‹ï¼${data.tag}æ¶ˆæ¯æ¥äº†ï¼\n\nåˆšæ‰çœ‹åˆ°${data.source}çš„æ¶ˆæ¯ï¼Œå¿ƒé‡ŒçŸ³å¤´ç»ˆäºè½åœ°äº†ï¼ğŸ˜‚\n\nğŸ‘‰ é‡ç‚¹åˆ’ä¸€ä¸‹\n${data.title}\n\nğŸ’­ ç¢ç¢å¿µ\næ¯å¹´éƒ½æœ‰å®¶é•¿å› ä¸ºé”™è¿‡æ—¶é—´èŠ‚ç‚¹åæ‚”ï¼Œè¿™æ¬¡å’±ä»¬åƒä¸‡åˆ«è¸©å‘ï¼\n\nğŸ’¡ é¿å‘å»ºè®®\n1. æ‰‹æœºæ—¥å†é©¬ä¸Šè®¾ç½®æé†’â°\n2. èµ„æ–™æå‰å‡†å¤‡å¥½ğŸ“‚\n3. å¿ƒæ€ç¨³ä½ï¼Œå­©å­æ‰ç¨³å¾—ä½ğŸ’ª\n\næœ‰ä¸æ‡‚çš„éšæ—¶é—®æˆ‘ï¼Œåœ¨çº¿ç­‰ï¼ğŸ‘‹\n\n#åå¸ˆæŒ‡è·¯ #å®¶é•¿å¿…è¯» #${data.tag}`;
            }

            // Cover Update
            document.getElementById('coverTitle').innerText = data.title;
            document.getElementById('coverTag').innerText = data.tag;

            const speed = fastMode ? 2 : 10;
            await typeWriter(shortText, shortOutput, speed);
            await typeWriter(xhsText, xhsOutput, speed/2);

            btn.disabled = false;
            btn.innerHTML = '<span><i class="fa-solid fa-sparkles mr-2"></i> é‡æ–°ç”Ÿæˆ</span>';
        }

        function typeWriter(text, element, speed) {
            return new Promise(resolve => {
                let i = 0;
                function type() { if (i < text.length) { element.innerHTML += text.charAt(i); i++; setTimeout(type, speed); } else { resolve(); } }
                type();
            });
        }

        // --- UTILS ---
        function copyText(id) {
            navigator.clipboard.writeText(document.getElementById(id).innerText).then(() => alert("å·²å¤åˆ¶ï¼"));
        }
        function copySourceText() {
            if(selectedItem) navigator.clipboard.writeText(selectedItem.title).then(() => alert("åŸæ–‡æ ‡é¢˜å·²å¤åˆ¶"));
        }

        function downloadCover() {
            const target = document.getElementById('captureTarget');
            const originalTransform = target.style.transform;
            target.style.transform = 'none';
            html2canvas(target, { scale: 3, useCORS: true, backgroundColor: null }).then(canvas => {
                canvas.toBlob(blob => saveAs(blob, `${document.getElementById('coverTitle').innerText}.png`));
                target.style.transform = originalTransform;
            });
        }

        function changeCoverBg(bgClass) {
            const target = document.getElementById('captureTarget');
            target.className = `title-card-wrapper ${bgClass} transform transition shadow-2xl`;
            // UI Dot selection
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('color-selected'));
            event.target.classList.add('color-selected');
        }

        function updateCoverPreview() {
            const title = document.getElementById('editTitleInput').value;
            if(title) document.getElementById('coverTitle').innerText = title;
        }

        function switchTab(tab) {
            if(tab === 'script') {
                document.getElementById('scriptView').classList.remove('hidden');
                document.getElementById('coverView').classList.add('hidden');
            } else {
                document.getElementById('scriptView').classList.add('hidden');
                document.getElementById('coverView').classList.remove('hidden');
            }
        }
        switchTab('script');
    </script>
</body>
</html>